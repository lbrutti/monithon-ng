<ion-content [fullscreen]="true" [scrollY]="false">

    <div id="container">
        <!-- Mappa -->
        <div #mapContainer id="mapContainer">

        </div>
        <!-- dettaglio progetto -->
        <div [ngClass]="{'hidden': !this.visualizzaDettaglio, 'visible': this.visualizzaDettaglio}" #schedaProgetto
            [attr.data-oc-cod-tema-sintetico]="this.progettoSelezionato.ocCodTemaSintetico"
            class="monithon-scheda-progetto">

            <h5>{{'schedaProgetto' | transloco}}</h5>
            <div #dettagliProgetto>
                <ion-grid>
                    <ion-row>
                        <ion-col col-6>
                            <h4>{{this.progettoSelezionato.ocTitoloProgetto}}</h4>
                            <hr>
                            <div #sintesiProgetto>
                                <span>{{this.progettoSelezionato.ocSintesiProgetto}}</span>
                            </div>
                        </ion-col>
                        <ion-col col-6>
                            <ion-label>{{this.progettoSelezionato.ocDataInizioProgetto}}</ion-label>
                            <ion-label>{{this.progettoSelezionato.ocDataInizioProgetto}}</ion-label>
                        </ion-col>
                    </ion-row>
                </ion-grid>

            </div>
        </div>

        <div id="panelContainer">
            <div id="filterContainer">
                <!-- Temi -->
                <mat-chip-list [ngClass]="{'monithon-temi': true}" aria-label="Temi progetto" multiple="true">
                    <mat-chip [ngClass]="{'monithon-tema': true}" *ngFor="let tema of this.temi"
                        [selected]="tema.isSelected" (click)="this.filterByTema(tema)"
                        [attr.data-oc-cod-tema-sintetico]="tema.ocCodTemaSintetico">
                        {{'temi.'+tema.ocCodTemaSintetico | transloco}}</mat-chip>
                </mat-chip-list>

                <!-- Categorie dei temi attivi -->
                <mat-expansion-panel class="monithon-filtri">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            {{'monithonFiltriTitle'|transloco}}
                        </mat-panel-title>

                    </mat-expansion-panel-header>
                    <ion-grid>
                        <ion-row>
                            <ion-col size="6">
                                <div #categorieDiSpesaContainer id="categorieDiSpesaContainer">
                                    <!-- parametrizzare con categorie dei progetti selezionati su mappa -->
                                    <mat-chip-list [ngClass]="{'monithon-categorie': true}" multiple="true"
                                        aria-orientation="horizontal">
                                        <mat-chip [ngClass]="{'monithon-categoria': true}" selectable="true"
                                            *ngFor="let categoria of this.categorie" [selected]="categoria.isSelected"
                                            (click)="this.filterByCategoria(categoria)"
                                            [attr.data-oc-cod-tema-sintetico]="categoria.ocCodTemaSintetico">
                                            {{'categorie.'+categoria.ocCodCategoriaSpesa | transloco}}
                                        </mat-chip>
                                    </mat-chip-list>
                                </div>
                            </ion-col>
                            <ion-col size="6">
                                <mat-expansion-panel class="monithon-filtri-charts" id="chartPanel">
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>
                                            {{'chartPanelTitle'|transloco}}
                                        </mat-panel-title>
                                    </mat-expansion-panel-header>
                                    <div id="chartContainer">
                                        <ion-grid>
                                            <ion-row>
                                                <ion-col>
                                                    <h3>{{'budgetChartTitle' |transloco}}</h3>
                                                    <div #budgetChart id='budgetChartContanier'></div>
                                                </ion-col>
                                            </ion-row>

                                            <ion-row>
                                                <ion-col>
                                                    <h3>{{'annoChartTitle'|transloco}}</h3>
                                                    <div #annoChart id='annoChartContanier'></div>
                                                </ion-col>
                                            </ion-row>
                                        </ion-grid>
                                    </div>
                                </mat-expansion-panel>
                            </ion-col>
                        </ion-row>
                    </ion-grid>

                </mat-expansion-panel>
            </div>
        </div>
        <div class="right-column">
            <mat-expansion-panel id="resultContainer">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h2>{{'resultContainerTitle' | transloco}}</h2>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="monithon-lista-header">
                    <ion-grid>
                        <ion-row>
                            <ion-col>
                                <h1 class="monithon-contatore-risultati" #resultCounter></h1>
                            </ion-col>
                            <ion-col><span>{{'comune'|transloco}}</span>; <span>{{'distanza'|transloco}}</span>
                            </ion-col>
                        </ion-row>
                        <!-- ordinamento -->
                        <ion-row>
                            <ion-col>
                                <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                                    <mat-expansion-panel-header>
                                        <span>{{'ordinati'|transloco}}</span>
                                        <mat-chip class="monithon-criterio-ordinamento-selezionato"
                                            [ngClass]="{'visible': !this.panelOpenState, 'hidden':this.panelOpenState}">
                                            Distanza</mat-chip>
                                    </mat-expansion-panel-header>
                                    <mat-chip-list class="monithon-criteri-ordinamento">
                                        <mat-chip>Distanza</mat-chip>
                                        <mat-chip>Categoria</mat-chip>
                                        <mat-chip>Budget</mat-chip>
                                        <mat-chip>Anno</mat-chip>
                                    </mat-chip-list>

                                </mat-expansion-panel>
                            </ion-col>
                        </ion-row>
                    </ion-grid>
                </div>
                <!-- lista risultati -->
                <ion-list #listaProgetti class="monithon-lista-progetti">
                    <ion-virtual-scroll>

                        <!-- COLLO DI BOTTIGLIA: verificare performance con loading incrementale -->
                        <ion-item *ngFor="let progetto of this.progetti">
                            <ion-label class="monithon-lista-risultato"
                                [attr.data-oc-cod-tema-sintetico]="progetto.ocCodTemaSintetico">
                                <h2>{{progetto.ocTitoloProgetto}}</h2>
                            </ion-label>
                        </ion-item>
                    </ion-virtual-scroll>
                </ion-list>
                <!-- <ion-infinite-scroll #infiniteScroll threshold="1px">
                    <ion-infinite-scroll-content (ionInfinite)="this.caricaProgetti()" loading-spinner="bubbles" loading-text="Loading more data...">
                    </ion-infinite-scroll-content>
                </ion-infinite-scroll> -->
            </mat-expansion-panel>
        </div>
    </div>
</ion-content>